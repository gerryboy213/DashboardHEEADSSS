<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="{{ url_for('static', filename='fontawesome/all.min.css') }}">

    <!-- Google Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;500&amp;display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='framework.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='admin_dashboard.css') }}">


    <style>
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            width: 215px; /* Adjusted width to be a bit smaller */
            overflow: hidden;
            background-color: #fff; /* Ensure background color is set */
        }
        .content {
            margin-left: 214px; /* Adjust this value based on the new width of your sidebar */
        }
    </style>
    
</head>

<body>
    <div class="page d-flex">
        <div class="sidebar bg-white p-20 p-relative">
            <h3 class="p-relative text-center mt-0">HEADSSS</h3>
            <ul>
                <li>
                    <a href="{{ url_for('admin_dashboard') }}" class="d-flex align-items-center font-14 p-10 rad-6 color-black">
                        <i class="fas fa-tachometer-alt fa-fw"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
               

                <li>
                    <a href="{{ url_for('admin_messages') }}" class="d-flex align-items-center font-14 p-10 rad-6 color-black">
                        <i class="fa-solid fa-envelope"></i>
                        <span>Messages</span>
                    </a>
                </li>

                <li>
                    <a href="{{ url_for('admin_list') }}" class="d-flex align-items-center font-14 p-10 rad-6 color-black">
                        <i class="fa-solid fa-people-group"></i>
                        <span>List of Client</span>
                    </a>
                </li>
               
                <li>
                    <a href="{{ url_for('admin_results')}}" class="d-flex align-items-center font-14 p-10 rad-6 color-black">
                        <i class="fa-solid fa-square-poll-horizontal"></i>
                        <span>Results</span>
                    </a>
                </li>
               
           <!-- <li>
                    <a href="{{ url_for('admin_files')}}" class="d-flex align-items-center font-14 p-10 rad-6 color-black">
                        <i class="fas fa-file fa-fw"></i>
                        <span>Files</span>
                    </a>
                </li> -->

                <li>
                    <a href="{{ url_for('admin_settings') }}" class="d-flex align-items-center font-14 p-10 rad-6 color-black">
                        <i class="fas fa-cog fa-fw"></i>
                        <span>Settings</span>
                    </a>
                </li>

               
                
            </ul>
        </div>
        <div class="content w-full">
              <!-- Start Header -->
              <div class="header bg-white p-15 between-flex">
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input id="searchInput" class="search-box" type="search" placeholder="Search Control Number">
                    <div id="searchResults" class="search-results"></div>
                </div>
                <div class="user d-flex align-items-center">

                    <!-- Notification Bell -->
                    <span class="notification p-relative" onclick="toggleNotifications()">
                        <i class="fa-regular fa-bell fa-lg p-relative"></i>
                        <span id="unread-count" class="unread-count" style="display: none;"></span>
                    </span>
                    
                    <!-- Notification Dropdown -->
                    <div id="notification-dropdown" class="dropdown-menu">
                        <strong>Notifications</strong>
                        <div id="notification-list"></div>
                        <div class="footer">
                            <a href="{{ url_for('admin_messages') }}">See All Messages <i class="fa fa-angle-right"></i></a>
                        </div>
                    </div>
            
                    <!-- User Info -->
                    <div class="user-info d-flex align-items-center">
                        <div class="user-img" id="userDropdownToggle">
                            <img src="/static/images/user.png" alt="User">
                        </div>
                    </div>
                    
                    <!-- Dropdown Menu -->
                    <div id="userDropdown" class="dropdown-menu">
                        <ul>
                            <li>
                                <a href="{{ url_for('admin_profile') }}" class="d-flex align-items-center font-14 p-10 rad-6 color-black">
                                    <i class="fas fa-user fa-fw"></i>
                                    <span>Profile</span>
                                </a>
                            </li>
                            <li>
                                <a href="{{ url_for('admin_logout') }}" class="d-flex align-items-center font-14 p-10 rad-6 color-black">
                                    <i class="fas fa-sign-out-alt fa-fw"></i>
                                    <span>Logout</span>
                                </a>
                            </li>
                        </ul>
                    </div>

                </div>
            </div>
            <!-- End Header -->

         
            <div class="overview bg-white m-20 p-20 rad-10">
                <h1 class="p-relative">Profile</h1>

                <div class="d-flex">
                    <div class="profile-info text-center p-20">
                        <img class="rad-half mb-10" src="/static/images/user.png" alt="User">
                        <p><strong>{{ admin.username }} </strong> </p>
                        <P class="mt-10 color-grey">{{ admin.job }}</P>
                        <div class="level rad-6 bg-eee p-relative">
                        
                        </div>
                        <div class="rating mt-10 mb-10">
                           
                        </div>
                       
                        <a href="javascript:void(0)" onclick="openEditProfilePanel()" class="btn btn-primary mt-10">Edit Profile</a>
                    </div>
                    <div class="info-box mt-20 flex-1">
                        <div class="box p-20 d-flex align-items-center flex-wrap">
                            <h4 class="color-grey font-15 m-0 w-full">General Information</h4>
                            <div class="font-14">
                                <span class="color-grey">Full Name:</span>
                                <span class="color-black">{{ admin.username }}</span>
                            </div>
                           
                           <!--  <div class="font-14">
                                <span class="color-grey">
                                    Date of Birth:
                                </span>
                                <span class="color-black">01/01/1990</span>
                            </div> -->
                            
                        </div>
                        <div class="box p-20 d-flex align-items-center flex-wrap">
                            <h4 class="color-grey font-15 m-0 w-full">Contact Information</h4>
                            <div class="font-14">
                                <span class="color-grey">Email:</span>
                                <span class="color-black">
                                    {{ admin.email }}
                                </span>
                            </div>
                            <div class="font-14">
                                <span class="color-grey">Phone:</span>
                                <span class="color-black">{{ admin.phone }}</span>
                            </div>
                           <!-- <div class="font-14">
                                <span class="color-grey">Website:</span>
                                <span class="color-black">www.admin.com</span>
                            </div> -->
                            <div class="font-14">
                                <span class="color-grey">Address:</span>
                                <span class="color-black">{{ admin.address }}</span>
                            </div>
                        </div>
                        <div class="box p-20 d-flex align-items-center flex-wrap">
                            <h4 class="color-grey font-15 m-0 w-full">Social Media</h4>
                            <div class="font-14">
                                <span class="color-grey">Facebook:</span>
                                <span class="color-black">Admin</span>
                            </div>
                            <div class="font-14">
                                <span class="color-grey">Twitter:</span>
                                <span class="color-black">@admin</span>
                            </div>
                            <div class="font-14">
                                <span class="color-grey">Instagram:</span>
                                <span class="color-black">@admin</span>
                            </div>
                            <div class="font-14">
                                <span class="color-grey">LinkedIn:</span>
                                <span class="color-black">admin</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="edit-profile-panel" id="editProfilePanel">
                <div class="panel-header">
                    <h2>Edit Profile</h2>
                    <button class="close-btn" onclick="closeEditProfilePanel()">×</button>
                </div>
                <form method="POST" action="{{ url_for('edit_admin_profile') }}">
                    <div class="form-group">
                        <label for="username">Username:</label>
                        <input type="text" id="username" name="username" value="{{ admin.username }}" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email:</label>
                        <input type="email" id="email" name="email" value="{{ admin.email }}">
                    </div>
                    <div class="form-group">
                        <label for="job">Job:</label>
                        <input type="text" id="job" name="job" value="{{ admin.job }}">
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone:</label>
                        <input type="text" id="phone" name="phone" value="{{ admin.phone }}">
                    </div>
                    <div class="form-group">
                        <label for="address">Address:</label>
                        <input type="text" id="address" name="address" value="{{ admin.address }}">
                    </div>
                    <div class="form-group">
                        <label for="password">New Password:</label>
                        <input type="password" id="password" name="password">
                    </div>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </form>
            </div>

            <div class="other-data d-flex flex-wrap gap-20">
                
                <div class="activities bg-white ml-20 mr-20 p-20 rad-10">
                    <h2 class="mt-0 mb-10">Latest Activities</h2>
                    <p class="mt-0 mb-20 color-grey font-15">Latest Activities Done By The User</p>
                    <div class="activity d-flex align-items-center">
                        <img src="/static/images/activity-01.png" alt="Store">
                        <div class="info flex-1">
                            <span class="d-block mb-10">Store</span>
                            <span class="color-grey">Bought The Mastering Python Course</span>
                        </div>
                        <div class="date">
                            <span class="d-block mb-10">18:10</span>
                            <span class="color-grey">Yesterday</span>
                        </div>
                    </div>
                    <div class="activity d-flex align-items-center">
                        <img src="/static/images/activity-02.png" alt="Academy">
                        <div class="info flex-1">
                            <span class="d-block mb-10">Academy</span>
                            <span class="color-grey">Got The PHP Certificate</span>
                        </div>
                        <div class="date">
                            <span class="d-block mb-10">16:05</span>
                            <span class="color-grey">Yesterday</span>
                        </div>
                    </div>
                    <div class="activity d-flex align-items-center">
                        <img src="/static/images/activity-03.png" alt="Badge">
                        <div class="info flex-1">
                            <span class="d-block mb-10">Badges</span>
                            <span class="color-grey">Unlocked The 10 Skills Badge</span>
                        </div>
                        <div class="date">
                            <span class="d-block mb-10">18:05</span>
                            <span class="color-grey">Yesterday</span>
                        </div>
                    </div>
                    <div class="activity d-flex align-items-center">
                        <img src="/static/images/activity-04.png" alt="Community">
                        <div class="info flex-1">
                            <span class="d-block mb-10">Community</span>
                            <span class="color-grey">Posted "Got My Developer Certification"</span>
                        </div>
                        <div class="date">
                            <span class="d-block mb-10">09:15</span>
                            <span class="color-grey">Today</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const notificationDropdown = document.getElementById("notification-dropdown");
            const notificationList = document.getElementById("notification-list");
            const bellIcon = document.querySelector(".notification");
            const unreadCount = document.getElementById("unread-count");
    
            function fetchNotifications() {
                fetch("/get_notifications")
                    .then(response => response.json())
                    .then(data => {
                        notificationList.innerHTML = ""; // Clear previous notifications
    
                        if (data.length > 0) {
                            unreadCount.textContent = data.length;
                            unreadCount.style.display = "inline-block"; // Show notification count

                            data.sort((a, b) => new Date(b.time) - new Date(a.time));
    
                            data.slice(0, 3).forEach(msg => { // Show only 5 notifications
                                const messageItem = document.createElement("div");
                                messageItem.classList.add("notification-item", msg.unread ? "unread" : "read");
    
                                messageItem.innerHTML = `
                                    <div class="icon"><i class="fa fa-envelope"></i></div>
                                    <div class="content">
                                        <div class="sender">${msg.sender}</div>
                                        <div class="message-preview">${msg.content.substring(0, 40)}...</div>
                                        <div class="time">${msg.time}</div>
                                    </div>
                                `;
    
                                messageItem.addEventListener("click", function () {
                                    if (msg.unread) {
                                        markNotificationAsRead(msg.id, messageItem);
                                    }
                                    window.location.href = `/admin/messages?message_id=${msg.id}`;
                                });
    
                                notificationList.appendChild(messageItem);
                            });
                        } else {
                            unreadCount.style.display = "none"; // Hide if no notifications
                            notificationList.innerHTML = "<p>No new notifications.</p>";
                        }
                    })
                    .catch(error => console.error("Error fetching notifications:", error));
            }
    
            function markNotificationAsRead(messageId, element) {
                fetch('/admin/mark_notification_read', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message_id: messageId })
                }).then(response => response.json())
                  .then(() => {
                      element.classList.remove("unread"); // Remove highlight
                      element.classList.add("read");
                      fetchNotifications(); // Refresh notifications after marking as read
                  });
            }
    
            function toggleDropdown() {
                notificationDropdown.classList.toggle("show");
            }
    
            // Close dropdown if clicked outside
            document.addEventListener("click", function (event) {
                if (!notificationDropdown.contains(event.target) && !bellIcon.contains(event.target)) {
                    notificationDropdown.classList.remove("show");
                }
            });
    
            bellIcon.addEventListener("click", toggleDropdown);
    
            // Fetch notifications initially and update every 5 seconds
            fetchNotifications();
            setInterval(fetchNotifications, 5000);
        });
    </script>
    

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const userDropdownToggle = document.getElementById("userDropdownToggle");
                const userDropdown = document.getElementById("userDropdown");
            
                userDropdownToggle.addEventListener("click", function (event) {
                    event.stopPropagation();
                    userDropdown.classList.toggle("show");
                });
            
                // Close dropdown if clicking outside
                document.addEventListener("click", function (event) {
                    if (!userDropdown.contains(event.target) && !userDropdownToggle.contains(event.target)) {
                        userDropdown.classList.remove("show");
                    }
                });
            });
            
        </script>
        <script>
            document.getElementById("searchInput").addEventListener("input", async function () {
                let query = this.value.trim();
                let searchResults = document.getElementById("searchResults");
            
                if (query === "") {
                    searchResults.style.display = "none";
                    return;
                }
            
                try {
                    let response = await fetch(`/search_control_num?q=${query}`);
                    let data = await response.json();
            
                    searchResults.innerHTML = "";
                    if (data.length === 0) {
                        searchResults.innerHTML = "<div>No results found</div>";
                    } else {
                        data.forEach(user => {
                            let div = document.createElement("div");
                            div.textContent = user.control_num;
                            div.onclick = () => window.location.href = `/view-client/${user.id}`;
                            searchResults.appendChild(div);
                        });
                    }
                    searchResults.style.display = "block";
                } catch (error) {
                    console.error("Error fetching search results:", error);
                }
            });
            
            // Hide results when clicking outside
            document.addEventListener("click", function (e) {
                let searchBox = document.getElementById("searchInput");
                let searchResults = document.getElementById("searchResults");
            
                if (!searchBox.contains(e.target) && !searchResults.contains(e.target)) {
                    searchResults.style.display = "none";
                }
            });
            
        </script>

        <script>

            function openEditProfilePanel() {
                document.getElementById("editProfilePanel").style.right = "0";
            }
            
            function closeEditProfilePanel() {
                document.getElementById("editProfilePanel").style.right = "-100%";
            }

        </script>
</body>

</html>