<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>View Client</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="{{ url_for('static', filename='fontawesome/all.min.css') }}">

    <!-- Google Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;500&amp;display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='framework.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='view.css') }}">

    <style>
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 367%;
            width: 215px; /* Default width */
            overflow: hidden;
            background-color: #fff;
            transition: all 0.3s ease; /* Smooth transition for responsiveness */
        }
    
        .content {
            margin-left: 215px; /* Default margin */
            transition: all 0.3s ease;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .sidebar {
                width: 60px; /* Collapse sidebar width */
            }
    
            .content {
                margin-left: 60px; /* Adjust content margin */
            }
    
            .sidebar ul li a span {
                display: none; /* Hide text in collapsed sidebar */
            }
    
            .sidebar h3 {
                display: none; /* Hide the title in collapsed sidebar */
            }
    
            .sidebar ul li a {
                justify-content: center; /* Center icons */
            }
        }
    
        @media (max-width: 480px) {
            .sidebar {
                position: absolute;
                width: 100%; /* Full width for smaller screens */
                height: auto;
                z-index: 1000;
            }
    
            .content {
                margin-left: 0; /* Remove margin for smaller screens */
            }
    
            .sidebar ul {
                display: flex;
                flex-direction: column;
                align-items: center;
            }
        }
    </style>

</head>

<body>
    
    <div class="page d-flex">
        <div class="sidebar bg-white p-20 p-relative">
            <h3 class="p-relative text-center mt-0">HEEADSSS</h3>
            <ul>
                <li>
                    <a href="{{ url_for('admin_dashboard') }}" class=" d-flex align-items-center font-14 p-10 rad-6 color-black">
                        <i class="fas fa-tachometer-alt fa-fw"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
              <!--  <li>
                    <a href="{{ url_for('admin_messages') }}" class="d-flex align-items-center font-14 p-10 rad-6 color-black">
                        <i class="fa-solid fa-envelope"></i>
                        <span>Messages</span>
                    </a>
                </li> -->
                <li>
                    <a href="{{ url_for('admin_list') }}" class="active d-flex align-items-center font-14 p-10 rad-6 color-black">
                        <i class="fa-solid fa-people-group"></i>
                        <span>List of Client</span>
                    </a>
                </li>
               
           <!--      <li>
                    <a href="{{ url_for('admin_results')}}" class="d-flex align-items-center font-14 p-10 rad-6 color-black">
                        <i class="fa-solid fa-square-poll-horizontal"></i>
                        <span>Results</span>
                    </a>
                </li>
             <li>
                    <a href="{{ url_for('admin_files')}}" class="d-flex align-items-center font-14 p-10 rad-6 color-black">
                        <i class="fas fa-file fa-fw"></i>
                        <span>Files</span>
                    </a>
                </li> -->
                <li>
                    <a href="{{ url_for('admin_settings') }}" class="d-flex align-items-center font-14 p-10 rad-6 color-black">
                        <i class="fas fa-cog fa-fw"></i>
                        <span>Profile</span>
                    </a>
                </li>
                
                <li>
                    <a href="{{ url_for('admin_logout') }}" class="d-flex align-items-center font-14 p-10 rad-6 color-black">
                        <i class="fas fa-sign-out-alt fa-fw"></i>
                        <span>Logout</span>
                    </a>
                </li>  
                
            </ul>
        </div>
        <div class="content w-full">
            <!-- Start Header -->
            <div class="header bg-white p-15 between-flex">
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input id="searchInput" class="search-box" type="search" placeholder="Search ... ">
                    <div id="searchResults" class="search-results"></div>
                </div>
                <div class="user d-flex align-items-center">

                    <!-- Notification Bell -->
                    <span class="notification p-relative">
                        <i class="fa-regular fa-bell fa-lg p-relative"></i>
                        <span id="unread-count" class="unread-count" style="display: none;"></span>
                    </span>
                    
                    <!-- Notification Dropdown -->
                    <div id="notification-dropdown" class="dropdown-menu-notif">
                        <strong>Notifications</strong>
                        <div id="notification-list" style=" overflow: hidden; margin-left:-200px; margin-top: 20px;"></div>
                        <div class="footer">
                            <a href="{{ url_for('admin_list') }}">See All <i class="fa fa-angle-right"></i></a>
                        </div>
                    </div>
            
                    <!-- User Info -->
                    <div class="user-info d-flex align-items-center">
                        <div class="user-img" id="userDropdownToggle">
                            <img src="{{ admin.profile_image or '/static/images/user.png' }}" alt="User">
                        </div>
                    </div>
                    
                 
                </div>
            </div>
            <!-- End Header -->
             
            
            <div class="wrapper d-grid gap-20">
                <!-- Start Welcome widget -->
                <div class="welcome bg-white rad-10 text-center-mobile">
                    <div class="intro d-flex justify-content-between p-20 bg-eee">
                        <div>
                            <h2 class="m-0">
                                Client Information & History
                            </h2>
                            <p class="font-15 color-grey mt-5">
                                Only you can see this information
                            </p>
                        </div>
                    </div>

               
                    
                    <div class="body text-center d-flex flex-column p-20 mt-20 mb-20">
                        <div class="table-scroll-wrapper">
                            <table class="info-table">
                                <tr>
                                    <td><strong>Control Number:</strong></td>
                                    <td colspan="3">{{ user.control_num }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Full Name:</strong></td>
                                    <td>{{ user.first_name }} {{ user.middle_initial }} {{ user.last_name }}</td>
                                    <td><strong>Sex:</strong></td>
                                    <td>{{ user.sex }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Date of Birth:</strong></td>
                                    <td>{{ user.dob }}</td>
                                    <td><strong>Age:</strong></td>
                                    <td>{{ user.age }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Contact:</strong></td>
                                    <td>{{ user.contact }}</td>
                                    <td><strong>Location:</strong></td>
                                    <td>{{ user.location }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Region:</strong></td>
                                    <td>{{ region_name }}</td>
                                    <td><strong>Province:</strong></td>
                                    <td>{{ province_name }}</td>
                                </tr>
                                <tr>
                                    <td><strong>City:</strong></td>
                                    <td>{{ city_name }}</td>
                                    <td><strong>Barangay:</strong></td>
                                    <td>{{ brgy_name }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Street/Sitio/Purok:</strong></td>
                                    <td>{{ user.street if user.street else 'N/A' }}</td>
                                    <td><strong>Date of Consultation:</strong></td>
                                    <td>{{ user.date }}</td>
                                </tr>
                            </table>

                               <div class="view-rapid">
                        <button id="rapid-btn" class="btn profile-btn font-14 color-white p-5" 
                            onclick="generateReport()"> View Rapid Results
                        </button>
                    </div>
                        </div>
                    </div>
                    
               

                 
                    
                    <!-- Rapid HEADSSS Form -->
                      <!-- Modal Container -->
<div id="reportModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-height: 80vh; overflow-y: auto;">
        <!-- Begin form -->
        <form method="POST" action="/save_services">

          <div style="text-align: center; margin-top: 20px;">
   <button type="button" onclick="printSummary()" class="print-btn">
  <i class="fas fa-print"></i> Print or Save as PDF <i class="fa-solid fa-file-pdf"></i>
</button>

</div>

            <div class="print-container">
                <table class="summary-table" id="summaryTable" style="margin-top: 40px;">
                    <thead>
                        <tr>
                            <th colspan="2" class="summary-title">Rapid HEEADSSS Results</th>
                        </tr>

                        <tr>
                            <th colspan="2" style="text-align: left;">
                                <div style="display: flex; flex-direction: column; gap: 5px;">
                                    <div style="display: flex; align-items: center; gap: 2px; height: 30px;">
                                        <label for="serviceProvider" style="width: 180px; font-size: 15px;">Accredited Facility Name:</label>
                                        <input type="text" id="centerName" name="center_name" class="input-field"
                                               value="{{ admin.center_name }}" readonly
                                               style="height: 35px; padding: 5px; font-size: 14px; border:none;" />
                                        <span id="serviceProviderText"></span>
                                    </div>
                                </div>
                            </th>
                        </tr>

                        <tr>
                            <th colspan="2" style="text-align: left;">
                                <div style="display: flex; flex-direction: column; gap: 10px;">
                                    <div style="display: flex; align-items: center; gap: 2px; height: 30px;">
                                        <label for="centerName" style="width: 180px; font-size: 15px;">Name of Service Provider: </label>
                                        <input type="text" id="centerName" name="center_name" class="input-field"
                                               style="font-size: 14px; height: 35px; padding: 5px; border:none;"
                                               value="{{ admin.full_name or '' }}" readonly>
                                        <span id="centerNameText"></span>
                                    </div>
                                </div>
                            </th>
                        </tr>

                        <tr>
                            <th colspan="2" style="text-align: left;">
                                <div style="display: flex; flex-direction: column; gap: 10px;">
                                    <div class="control-number-container" style="display: flex; align-items: center; gap: 10px;">
                                        <strong style="width: 115px; font-size: 15px;">Control Number:</strong>
                                        <span style="width: 200px; font-size: 15px;">{{ user.control_num }}</span>
                                    </div>
                                </div>
                            </th>
                        </tr>
                    </thead>
                </table>
            </div>

            <!-- Updated table without the "No" column -->
            <table class="summary-table" border="1" width="100%">
                {% set yes_answers = [] %}
                {% for id, data in questions_with_answers.items() %}
                    {% if data.answer == 'Yes' %}
                        {% set _ = yes_answers.append(data) %}
                    {% endif %}
                {% endfor %}

                <tbody style="font-size: 15px;">
                    {% if yes_answers | length > 0 %}
                        <tr>
                            <th style="font-size: 15px; text-align: center; background-color: lightgreen; padding: 10px 10px;">Question</th>
                            <th style="font-size: 15px; text-align: center; background-color: lightgreen; padding: 10px 10px;">Answer</th>
                        </tr>
                        {% for data in yes_answers %}
                        <tr>
                            <td style="padding: 8px; text-align: justify;">
                                {{ data.question }}
                            </td>
                            <td style="padding: 8px; text-align: center;">
                                <i class="fas fa-check-circle" style="color: green;"></i> Yes
                            </td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="2" style="text-align: center; padding: 15px; font-style: italic; color: red;">
                                The client answered "No" to all questions.
                            </td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>

            <div class="container-message">
                <h3 class="section-title" style="padding-top: 2px">Interpretation</h3>
                {% if formatted_messages %}
                    <div class="message-card">
                        <ul>
                            {% for paragraph in formatted_messages %}
                                <li class="justified-text">{{ paragraph | safe }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %}
            </div>
            <h4> Services Provided and Recommended Action from the Brgy</h4> 

<div class="recommendation-container">
    <div class="recommendation-section">
        <label class="print-label" style="font-weight: bold; font-size: 16px;">Services Provided:</label>
        <div class="checkbox-group">
            <div>
                <input type="checkbox" name="services_provided[]" value="Assessed using HEEADSSS"
                    {% if 'Assessed using HEEADSSS' in saved_services %}checked{% endif %}>
                <label>Assessed using HEEADSSS</label>
            </div>
            <div>
                <input type="checkbox" name="services_provided[]" value="Reached by HYO"
                    {% if 'Reached by HYO' in saved_services %}checked{% endif %}>
                <label>Reached by HYO</label>
            </div>
            <div>
                <input type="checkbox" name="services_provided[]" value="Refer to RHU"
                    {% if 'Refer to RHU' in saved_services %}checked{% endif %}>
                <label>Referred to RHU</label>
            </div>
            <div>
                <input type="checkbox" name="services_provided[]" value="Refer to Hospital"
                    {% if 'Refer to Hospital' in saved_services %}checked{% endif %}>
                <label>Referred to Hospital</label>
            </div>
            <div>
                <input type="checkbox" name="services_provided[]" value="Refer to DSWD"
                    {% if 'Refer to DSWD' in saved_services %}checked{% endif %}>
                <label>Referred to DSWD</label>
            </div>
            <div>
                <input type="checkbox" name="services_provided[]" value="Parental Notification"
                    {% if 'Parental Notification' in saved_services %}checked{% endif %}>
                <label>Parental Notification</label>
            </div>
            <div>
                <input type="checkbox" name="services_provided[]" value="Preventive Counseling"
                    {% if 'Preventive Counseling' in saved_services %}checked{% endif %}>
                <label>Preventive Counseling</label>
            </div>
            <div>
                <input type="checkbox" id="scheduleFollowUp" name="services_provided[]" value="Schedule Follow-up"
                    {% if 'Schedule Follow-up' in saved_services or follow_up_datetime %}checked{% endif %}>
                <label for="scheduleFollowUp">Schedule Follow-up</label>
            </div>
            <div id="calendarContainer"
                style="{% if 'Schedule Follow-up' in saved_services or follow_up_datetime %}display: block;{% else %}display: none;{% endif %} margin-top: 10px;">
                <label for="followUpDateTime">Set date and time:</label>
                <input type="datetime-local" id="followUpDateTime" name="follow_up_datetime"
                    value="{{ follow_up_datetime }}">
            </div>
        </div>

        <div class="other-container">
            <input type="checkbox" id="otherOption" name="services_provided[]" value="other"
                onchange="toggleOtherServiceInput()"
                {% if 'Other' in saved_services %}checked{% endif %}>
            <label for="otherOption">Other services provided:</label>

            <input type="text" id="otherServiceInput" name="other_service_detail" placeholder="Please specify"
                style="{% if 'Other' in saved_services %}display: block;{% else %}display: none;{% endif %} margin-top: 5px;"
                value="{{ other_service_detail }}">
        </div>

        <div id="otherServiceContainer" style="display: none; margin-top: 10px;">
            <input type="text" id="otherService" name="other_service" class="input-field" placeholder="Enter your service"
                style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; display: block;">
        </div>
    </div>

    <div id="servicesPrintText"></div>

    <div class="separator"></div>

    <div class="recommendation-section">
        <label class="print-label" style="font-weight: bold; font-size: 16px;">Recommended Action:</label>
        <div class="checkbox-group">
            <div>
                <input type="checkbox" name="recommended_action" value="Home Visitation"
                    {% if 'Home Visitation' in saved_recommendations %}checked{% endif %}>
                <label>Home Visitation</label>
            </div>
            <div>
                <input type="checkbox" name="recommended_action" value="Reached by HYO"
                    {% if 'Reached by HYO' in saved_recommendations %}checked{% endif %}>
                <label>Reached by HYO</label>
            </div>
            <div>
                <input type="checkbox" name="recommended_action" value="Refer to RHU"
                    {% if 'Refer to RHU' in saved_recommendations %}checked{% endif %}>
                <label>Refer to RHU</label>
            </div>
            <div>
                <input type="checkbox" name="recommended_action" value="Refer to Hospital"
                    {% if 'Refer to Hospital' in saved_recommendations %}checked{% endif %}>
                <label>Refer to Hospital</label>
            </div>
            <div>
                <input type="checkbox" name="recommended_action" value="Refer to DSWD"
                    {% if 'Refer to DSWD' in saved_recommendations %}checked{% endif %}>
                <label>Refer to DSWD</label>
            </div>
            <div>
                <input type="checkbox" name="recommended_action" value="Parental Notification"
                    {% if 'Parental Notification' in saved_recommendations %}checked{% endif %}>
                <label>Parental Notification</label>
            </div>
            <div>
                <input type="checkbox" name="recommended_action" value="Preventive Counseling"
                    {% if 'Preventive Counseling' in saved_recommendations %}checked{% endif %}>
                <label>Preventive Counseling</label>
            </div>
            <div>
                <input type="checkbox" id="recommendedFollowUp" name="recommended_action" value="Schedule Follow-up"
                    {% if 'Schedule Follow-up' in saved_recommendations or recommended_follow_up_datetime %}checked{% endif %}>
                <label for="recommendedFollowUp">Schedule Follow-up</label>
            </div>
            <div id="recommendedCalendarContainer"
                style="{% if 'Schedule Follow-up' in saved_recommendations or recommended_follow_up_datetime %}display: block;{% else %}display: none;{% endif %} margin-top: 10px;">
                <label for="recommendedFollowUpDateTime">Set date and time:</label>
                <input type="datetime-local" id="recommendedFollowUpDateTime" name="recommended_follow_up_datetime"
                    value="{{ recommended_follow_up_datetime }}">
            </div>
        </div>

        <div class="other-container">
            <input type="checkbox" id="otherOption2" onchange="toggleOtherRecommendationInput()"
                {% if other_recommendation %}checked{% endif %}>
            <label for="otherOption2">Other recommended actions:</label>
        </div>
        <div id="otherRecommendationContainer"
            style="display: {% if other_recommendation %}block{% else %}none{% endif %}; margin-top: 10px;">
            <input type="text" id="otherRecommendation" name="other_recommendation" class="input-field"
                value="{{ other_recommendation or '' }}" placeholder="Enter your recommendation"
                style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; display: block;">
        </div>
    </div>

    <div id="recommendedPrintText"></div>
</div>
<div class="administered-wrapper" style="text-align: left; margin-top: 50px; padding-left: 20px;">
    <div id="administered" style="display: flex; align-items: center;">
        <div>Administered by:</div>
        <div style="margin-left: 10px;">
            <div style="text-align: center;">
                {% if signature %}
                <img src="{{ url_for('static', filename='uploads/' + signature.filename) }}"
                    alt="Signature" style="height: 50px; display: block; margin: 0 auto 5px auto;">
                {% endif %}
                <span style="border-bottom: 1px solid #000; padding: 0 20px; display: inline-block;">
                    {{ admin.username }}
                </span>
            </div>
        </div>
    </div>
</div>



        </form>
        <!-- End form -->
    </div>
</div>


                                    
<!--<div id="printSpacer" style="display: none;"></div>

                                        <h4> Services Provided and Recommended Action by the  Brgy</h4> 

                                    <div class="recommendation-container">
                                   
                                        <div class="recommendation-section">
                                            <label class="print-label" style="font-weight: bold; font-size: 16px;">Services Provided:</label>
                                            <div class="checkbox-group">
                                                <div><input type="checkbox" name="services_provided[]" value="Assessed using HEEADSSS"
                                                    {% if 'Assessed using HEEADSSS' in saved_services %}checked{% endif %}>
                                                    <label>Assessed using HEEADSSS</label>
                                                </div>
                                            
                                                <div><input type="checkbox" name="services_provided[]" value="Reached by HYO"
                                                    {% if 'Reached by HYO' in saved_services %}checked{% endif %}>
                                                    <label>Reached by HYO</label>
                                                </div>
                                            
                                                <div><input type="checkbox" name="services_provided[]" value="Refer to RHU"
                                                    {% if 'Refer to RHU' in saved_services %}checked{% endif %}>
                                                    <label>Refer to RHU</label>
                                                </div>
                                            
                                                <div><input type="checkbox" name="services_provided[]" value="Refer to Hospital"
                                                    {% if 'Refer to Hospital' in saved_services %}checked{% endif %}>
                                                    <label>Refer to Hospital</label>
                                                </div>
                                            
                                                <div><input type="checkbox" name="services_provided[]" value="Refer to DSWD"
                                                    {% if 'Refer to DSWD' in saved_services %}checked{% endif %}>
                                                    <label>Refer to DSWD</label>
                                                </div>
                                            
                                                <div><input type="checkbox" name="services_provided[]" value="Parental Notification"
                                                    {% if 'Parental Notification' in saved_services %}checked{% endif %}>
                                                    <label>Parental Notification</label>
                                                </div>
                                            
                                                <div><input type="checkbox" name="services_provided[]" value="Preventive Counseling"
                                                    {% if 'Preventive Counseling' in saved_services %}checked{% endif %}>
                                                    <label>Preventive Counseling</label>
                                                </div>
                                            
                                                <div>
                                                    <input type="checkbox" id="scheduleFollowUp" name="services_provided[]" value="Schedule Follow-up"
                                                    {% if 'Schedule Follow-up' in saved_services or follow_up_datetime %}checked{% endif %}>
                                                  <label for="scheduleFollowUp">Schedule Follow-up</label>
                                                  
                                                </div>
                                                  
                                               
                                                  <div id="calendarContainer"
                                                  style="{% if 'Schedule Follow-up' in saved_services or follow_up_datetime %}display: block;{% else %}display: none;{% endif %} margin-top: 10px;">
                                               <label for="followUpDateTime">Set date and time:</label>
                                               <input type="datetime-local" id="followUpDateTime" name="follow_up_datetime"
                                               value="{{ follow_up_datetime }}">

                                          

                                             </div>
                                            
                                            </div>

                                            <div class="other-container">
                                                <input type="checkbox" id="otherOption" name="services_provided[]" value="other"
                                                    onchange="toggleOtherServiceInput()"
                                                    {% if 'Other' in saved_services %}checked{% endif %}>
                                                <label for="otherOption">Other services provided:</label>

                                                <input type="text" id="otherServiceInput" name="other_service_detail" placeholder="Please specify"
                                                    style="{% if 'Other' in saved_services %}display: block;{% else %}display: none;{% endif %} margin-top: 5px;"
                                                    value="{{ other_service_detail }}">

                                            </div>
                                            
                                            <div id="otherServiceContainer" style="display: none; margin-top: 10px;">
                                                <input type="text" id="otherService" name="other_service" class="input-field" placeholder="Enter your service" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; display: block;">
                                            </div>    

                                        </div>
                                        
                                        <div id="servicesPrintText"></div>

                                      
                                        <div class="separator"></div>
                                    
                                        
                                        <div class="recommendation-section">
                                            <label class="print-label" style="font-weight: bold; font-size: 16px;">Recommended Action:</label>
                                            <div class="checkbox-group">
                                                <div>
                                                    <input type="checkbox" name="recommended_action" value="Home Visitation"
                                                        {% if 'Home Visitation' in saved_recommendations %}checked{% endif %}>
                                                    <label>Home Visitation</label>
                                                </div>
                                                <div>
                                                    <input type="checkbox" name="recommended_action" value="Reached by HYO"
                                                        {% if 'Reached by HYO' in saved_recommendations %}checked{% endif %}>
                                                    <label>Reached by HYO</label>
                                                </div>
                                                <div>
                                                    <input type="checkbox" name="recommended_action" value="Refer to RHU"
                                                        {% if 'Refer to RHU' in saved_recommendations %}checked{% endif %}>
                                                    <label>Refer to RHU</label>
                                                </div>
                                                <div>
                                                    <input type="checkbox" name="recommended_action" value="Refer to Hospital"
                                                        {% if 'Refer to Hospital' in saved_recommendations %}checked{% endif %}>
                                                    <label>Refer to Hospital</label>
                                                </div>

                                                <div>
                                                    <input type="checkbox" name="recommended_action" value="Refer to DSWD"
                                                        {% if 'Refer to DSWD' in saved_recommendations %}checked{% endif %}>
                                                    <label>Refer to DSWD</label>
                                                </div>
                                                <div>
                                                    <input type="checkbox" name="recommended_action" value="Parental Notification"
                                                        {% if 'Parental Notification' in saved_recommendations %}checked{% endif %}>
                                                    <label>Parental Notification</label>
                                                </div>
                                                <div>
                                                    <input type="checkbox" name="recommended_action" value="Preventive Counseling"
                                                        {% if 'Preventive Counseling' in saved_recommendations %}checked{% endif %}>
                                                    <label>Preventive Counseling</label>
                                                </div>

                                                <div>
                                                    <input type="checkbox" id="recommendedFollowUp" name="recommended_action" value="Schedule Follow-up"
                                                           {% if 'Schedule Follow-up' in saved_recommendations or recommended_follow_up_datetime %}checked{% endif %}>
                                                    <label for="recommendedFollowUp">Schedule Follow-up</label>
                                                </div>
                                                
                                               
                                                <div id="recommendedCalendarContainer"
                                                     style="{% if 'Schedule Follow-up' in saved_recommendations or recommended_follow_up_datetime %}display: block;{% else %}display: none;{% endif %} margin-top: 10px;">
                                                    <label for="recommendedFollowUpDateTime">Set date and time:</label>
                                                    <input type="datetime-local" id="recommendedFollowUpDateTime" name="recommended_follow_up_datetime"
                                                           value="{{ recommended_follow_up_datetime }}">
                                                </div>
                                                
                                                

                                                
                                            </div>
                                            
                                            <div class="other-container">
                                                <input type="checkbox" id="otherOption2" onchange="toggleOtherRecommendationInput()"
                                                    {% if other_recommendation %}checked{% endif %}>
                                                <label for="otherOption2">Other recommended actions:</label>
                                            </div>
                                            <div id="otherRecommendationContainer" style="display: {% if other_recommendation %}block{% else %}none{% endif %}; margin-top: 10px;">
                                                <input type="text" id="otherRecommendation" name="other_recommendation"
                                                    class="input-field"
                                                    value="{{ other_recommendation or '' }}"
                                                    placeholder="Enter your recommendation"
                                                    style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; display: block;">
                                            </div>
                                                                       
                                        </div>

                                        <div id="recommendedPrintText"></div>



                                    </div>

                                    <h4> Services Provided and Recommended Action by the Brgy</h4> 

                                 <div class="recommendation-container">
                                      
                                        <div class="recommendation-section">
                                            <label class="print-label" style="font-weight: bold; font-size: 16px;">Services Provided:</label>
                                            <div class="checkbox-group">
                                                <div><input type="checkbox" name="services_provided[]" value="Assessed using HEEADSSS"
                                                    {% if 'Assessed using HEEADSSS' in saved_services %}checked{% endif %}>
                                                    <label>Assessed using HEEADSSS</label>
                                                </div>
                                            
                                                <div><input type="checkbox" name="services_provided[]" value="Reached by HYO"
                                                    {% if 'Reached by HYO' in saved_services %}checked{% endif %}>
                                                    <label>Reached by HYO</label>
                                                </div>
                                            
                                                <div><input type="checkbox" name="services_provided[]" value="Refer to RHU"
                                                    {% if 'Refer to RHU' in saved_services %}checked{% endif %}>
                                                    <label>Refer to RHU</label>
                                                </div>
                                            
                                                <div><input type="checkbox" name="services_provided[]" value="Refer to Hospital"
                                                    {% if 'Refer to Hospital' in saved_services %}checked{% endif %}>
                                                    <label>Refer to Hospital</label>
                                                </div>
                                            
                                                <div><input type="checkbox" name="services_provided[]" value="Refer to DSWD"
                                                    {% if 'Refer to DSWD' in saved_services %}checked{% endif %}>
                                                    <label>Refer to DSWD</label>
                                                </div>
                                            
                                                <div><input type="checkbox" name="services_provided[]" value="Parental Notification"
                                                    {% if 'Parental Notification' in saved_services %}checked{% endif %}>
                                                    <label>Parental Notification</label>
                                                </div>
                                            
                                                <div><input type="checkbox" name="services_provided[]" value="Preventive Counseling"
                                                    {% if 'Preventive Counseling' in saved_services %}checked{% endif %}>
                                                    <label>Preventive Counseling</label>
                                                </div>
                                            
                                                <div>
                                                    <input type="checkbox" id="scheduleFollowUp" name="services_provided[]" value="Schedule Follow-up"
                                                    {% if 'Schedule Follow-up' in saved_services or follow_up_datetime %}checked{% endif %}>
                                                  <label for="scheduleFollowUp">Schedule Follow-up</label>
                                                  
                                                </div>
                                                  
                                                 
                                                  <div id="calendarContainer"
                                                  style="{% if 'Schedule Follow-up' in saved_services or follow_up_datetime %}display: block;{% else %}display: none;{% endif %} margin-top: 10px;">
                                               <label for="followUpDateTime">Set date and time:</label>
                                               <input type="datetime-local" id="followUpDateTime" name="follow_up_datetime"
                                               value="{{ follow_up_datetime }}">

                                           

                                             </div>
                                            
                                            </div>

                                            <div class="other-container">
                                                <input type="checkbox" id="otherOption" name="services_provided[]" value="other"
                                                    onchange="toggleOtherServiceInput()"
                                                    {% if 'Other' in saved_services %}checked{% endif %}>
                                                <label for="otherOption">Other services provided:</label>

                                                <input type="text" id="otherServiceInput" name="other_service_detail" placeholder="Please specify"
                                                    style="{% if 'Other' in saved_services %}display: block;{% else %}display: none;{% endif %} margin-top: 5px;"
                                                    value="{{ other_service_detail }}">

                                            </div>
                                            
                                            <div id="otherServiceContainer" style="display: none; margin-top: 10px;">
                                                <input type="text" id="otherService" name="other_service" class="input-field" placeholder="Enter your service" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; display: block;">
                                            </div>    

                                        </div>
                                        
                                        <div id="servicesPrintText"></div>

                                       
                                        <div class="separator"></div>
                                    
                                      
                                        <div class="recommendation-section">
                                            <label class="print-label" style="font-weight: bold; font-size: 16px;">Recommended Action:</label>
                                            <div class="checkbox-group">
                                                <div>
                                                    <input type="checkbox" name="recommended_action" value="Home Visitation"
                                                        {% if 'Home Visitation' in saved_recommendations %}checked{% endif %}>
                                                    <label>Home Visitation</label>
                                                </div>
                                                <div>
                                                    <input type="checkbox" name="recommended_action" value="Reached by HYO"
                                                        {% if 'Reached by HYO' in saved_recommendations %}checked{% endif %}>
                                                    <label>Reached by HYO</label>
                                                </div>
                                                <div>
                                                    <input type="checkbox" name="recommended_action" value="Refer to RHU"
                                                        {% if 'Refer to RHU' in saved_recommendations %}checked{% endif %}>
                                                    <label>Refer to RHU</label>
                                                </div>
                                                <div>
                                                    <input type="checkbox" name="recommended_action" value="Refer to Hospital"
                                                        {% if 'Refer to Hospital' in saved_recommendations %}checked{% endif %}>
                                                    <label>Refer to Hospital</label>
                                                </div>

                                                <div>
                                                    <input type="checkbox" name="recommended_action" value="Refer to DSWD"
                                                        {% if 'Refer to DSWD' in saved_recommendations %}checked{% endif %}>
                                                    <label>Refer to DSWD</label>
                                                </div>
                                                <div>
                                                    <input type="checkbox" name="recommended_action" value="Parental Notification"
                                                        {% if 'Parental Notification' in saved_recommendations %}checked{% endif %}>
                                                    <label>Parental Notification</label>
                                                </div>
                                                <div>
                                                    <input type="checkbox" name="recommended_action" value="Preventive Counseling"
                                                        {% if 'Preventive Counseling' in saved_recommendations %}checked{% endif %}>
                                                    <label>Preventive Counseling</label>
                                                </div>

                                                <div>
                                                    <input type="checkbox" id="recommendedFollowUp" name="recommended_action" value="Schedule Follow-up"
                                                           {% if 'Schedule Follow-up' in saved_recommendations or recommended_follow_up_datetime %}checked{% endif %}>
                                                    <label for="recommendedFollowUp">Schedule Follow-up</label>
                                                </div>
                                                
                                              
                                                <div id="recommendedCalendarContainer"
                                                     style="{% if 'Schedule Follow-up' in saved_recommendations or recommended_follow_up_datetime %}display: block;{% else %}display: none;{% endif %} margin-top: 10px;">
                                                    <label for="recommendedFollowUpDateTime">Set date and time:</label>
                                                    <input type="datetime-local" id="recommendedFollowUpDateTime" name="recommended_follow_up_datetime"
                                                           value="{{ recommended_follow_up_datetime }}">
                                                </div>
                                                
                                                

                                                
                                            </div>
                                            
                                            <div class="other-container">
                                                <input type="checkbox" id="otherOption2" onchange="toggleOtherRecommendationInput()"
                                                    {% if other_recommendation %}checked{% endif %}>
                                                <label for="otherOption2">Other recommended actions:</label>
                                            </div>
                                            <div id="otherRecommendationContainer" style="display: {% if other_recommendation %}block{% else %}none{% endif %}; margin-top: 10px;">
                                                <input type="text" id="otherRecommendation" name="other_recommendation"
                                                    class="input-field"
                                                    value="{{ other_recommendation or '' }}"
                                                    placeholder="Enter your recommendation"
                                                    style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; display: block;">
                                            </div>
                                                                       
                                        </div>

                                        <div id="recommendedPrintText"></div>

                                        

                                    </div>
                           <div class="administered-wrapper" style="text-align: left; margin-top: 50px; padding-left: 20px;">
                                <div id="administered" style="display: flex; align-items: center;">
                                    <div>Administered by:</div>
                                    <div style="margin-left: 10px;">
                                    <div style="text-align: center;">
                                        {% if signature %}
                                        <img src="{{ url_for('static', filename='uploads/' + signature.filename) }}"
                                            alt="Signature" style="height: 50px; display: block; margin: 0 auto 5px auto;">

                                        {% endif %}
                                        <span style="border-bottom: 1px solid #000; padding: 0 20px; display: inline-block;">
                                        {{ admin.username }}
                                        </span>
                                    </div>
                                    </div>
                                </div>
                                </div>

                                      

                                    <div style="text-align: center; margin-top: 20px;">
                                        <button id="saveButton" data-user-id="{{ user.id }}" style="padding: 10px 20px; font-size: 16px; background-color: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                            Save
                                        </button>
                                    </div>

                                </form>
                            </div>
                        </div>
                    </div>
                </div>-->
                
                     <!-- Comprehensive HEADSSS Form -->
                     <div id="comprehensive-summary" style="display: none; margin-top: 20px;">
                        <div class="wrapper d-grid gap-20">
                            <div class="welcome bg-white rad-10 text-center-mobile">
                               
                                
                                <div class="body text-center d-flex flex-column p-20 mt-20 mb-20">
                                    <!-- Buttons -->
                                    <div class="button-container">
                                    <!--<button onclick="exportToPDF()" class="export-btn">
                                            <i class="fas fa-file-pdf"></i> Export to PDF
                                        </button>  -->
    
                                        <button onclick="printSummary()" class="print-btn">
                                            <i class="fas fa-print"></i> Print or Save as PDF <i class="fa-solid fa-file-pdf"></i>
                                        </button>
    
                                    </div>
                    
                                    <!-- Summary Table -->
                                    <form method="POST">
                                        <table class="summary-table" id="summaryTable" style="margin-top: 40px;">
                                            <thead>
                                                <tr>
                                                    <th colspan="2" class="summary-title">  Comprehensive HEEADSSS Results</th>
                                                </tr>
    
                                                <tr>
                                                    <th colspan="2" style="text-align: left;">
                                                        <div style="display: flex; flex-direction: column; gap: 5px;">
                                                           <div style="display: flex; align-items: center; gap: 10px;">
                                                                <label for="serviceProvider" style="width: 100px; font-size: 15px;">Center Name:</label>
                                                                <select id="serviceProvider" name="service_provider" class="input-field" required onchange="updateProviderText()">
                                                                    <option value="" disabled selected>Select center name</option>
                                                                    <option value="RHU">RHU</option>
                                                                    <option value="Hospital">Hospital</option>
                                                                    <option value="School">School</option>
                                                                </select>
                                                                <span id="serviceProviderText"></span>
                                                            </div>    
                                                        </div>
                                                    </th>
                                                </tr>
    
                                                <tr>
                                                    <th colspan="2" style="text-align: left;">
                                                        <div style="display: flex; flex-direction: column; gap: 10px;">
                                                            <div style="display: flex; align-items: center; gap: 10px;">
                                                                    <label for="centerName" style="width: 180px; font-size: 15px;">Name of Service Provider: </label>
                                                                    <input type="text" id="centerName" name="center_name" class="input-field" 
                                                                    style="font-size: 15px;" value="{{ admin_username or '' }}" readonly>                                                                                          
                                                                    <span id="centerNameText"></span>
                                                            </div>
                                                        </div>
                                                    </th>
                                                </tr>
            
                                                <tr>
                                                    <th colspan="2" style="text-align: left;">
                                                        <div style="display: flex; flex-direction: column; gap: 10px;">
                                                            <div style="display: flex; align-items: center; gap: 10px;">
                                                                <strong style="width: 115px; font-size: 15px;">Control Number:</strong>
                                                                <span style="width: 200px; font-size: 15px;">{{ user.control_num }}</span>
                                                            </div>    
                                                        </div>
                                                    </th>
                                                </tr>
                                                
                                            </thead>
                                        </table>
    
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                 
                </div>
            </div>

        </div>
        <script src = "https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

        <script>
            function exportToPDF() {
                const { jsPDF } = window.jspdf;

                // Use media print styles
                document.body.classList.add("print-mode");

                // Target the summary table
                const element = document.getElementById("summaryTable");

                html2canvas(element, {
                    scale: 2,  // High resolution
                    useCORS: true,  // Support for external styles
                    logging: false
                }).then(canvas => {
                    const imgData = canvas.toDataURL("image/png");
                    const pdf = new jsPDF("p", "mm", "a4");
                    const imgWidth = 210; // A4 width in mm
                    const imgHeight = (canvas.height * imgWidth) / canvas.width; // Maintain aspect ratio
                    
                    pdf.addImage(imgData, "PNG", 0, 10, imgWidth, imgHeight);
                    pdf.save("summary.pdf");

                    document.body.classList.remove("print-mode");
                });
            }
        </script>

        <script>

            document.addEventListener("DOMContentLoaded", function () {
                const notificationDropdown = document.getElementById("notification-dropdown");
                const notificationList = document.getElementById("notification-list");
                const bellIcon = document.querySelector(".notification");
                const unreadCount = document.getElementById("unread-count");
            
                async function fetchNotifications() {
                    console.log("Fetching notifications...");
            
                    try {
                        const response = await fetch("/get_notifications");
                        if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
            
                        const data = await response.json();
                        console.log("Received notifications:", data);
            
                        notificationList.innerHTML = ""; // Clear previous notifications
            
                        if (!data || data.length === 0) {
                            unreadCount.style.display = "none";
                            notificationList.innerHTML = `
                                <div style="text-align: center; color: #888; font-size: 14px; padding-left: 180px; margin-bottom:20px">
                                    <i class="fas fa-inbox" style="font-size: 20px; margin-bottom: 5px;"></i><br>
                                    No new notifications
                                </div>
                            `;
                            return;
                        }
            
                        unreadCount.textContent = data.length;

                        unreadCount.style.display = "inline-block"; // Show notification count      

                        const sortedData = data.sort((a, b) => new Date(b.time) - new Date(a.time));

                        // Display notifications
                        sortedData.forEach(notification => {

                            let notificationItem = document.createElement("div");
                            notificationItem.classList.add("notification-item");
            
                            // Ensure notification contains `user_id`
                            notificationItem.dataset.userId = notification.user_id;
            
                           // Determine icon and color based on urgency
                            let iconClass = "fas fa-check-circle"; // default low urgency
                            let iconColor = "#10b981"; // green

                            if (notification.urgency === "high") {
                                iconClass = "fas fa-exclamation-circle";
                                iconColor = "#dc2626"; // red
                            } else if (notification.urgency === "medium") {
                                iconClass = "fas fa-exclamation-circle";
                                iconColor = "#eab308"; // yellow
                            }

                            notificationItem.innerHTML = `
                              <div class="content" style="display: flex; align-items: center; gap: 10px;">
                                  <!-- Icon on the left side -->
                                  <i class="${iconClass}" style="color: ${iconColor}; font-size: 16px;"></i>
                                  
                                  <div>
                                      <span class="sender" style="font-weight: bold;">${notification.sender}</span><br>
                                      <span class="message-preview">${notification.content}</span><br>
                                      <span class="time">${formatTime(notification.time)}</span>
                                  </div>
                              </div>
                          `;


            
                            // Redirect to view-client when clicked
                            notificationItem.addEventListener("click", function () {
                                const userId = this.dataset.userId;
                                if (userId) {
                                    window.location.href = `/view-client/${userId}`;
                                }
                            });
            
                            notificationList.appendChild(notificationItem);
                        });
            
                    } catch (error) {
                        console.error("Error fetching notifications:", error);
                    }
                }
            
                function toggleNotifications(event) {
                    event.stopPropagation();
                    notificationDropdown.classList.toggle("show");
                }
            
                document.addEventListener("click", function (event) {
                    if (!notificationDropdown.contains(event.target) && !bellIcon.contains(event.target)) {
                        notificationDropdown.classList.remove("show");
                    }
                });
            
                bellIcon.addEventListener("click", toggleNotifications);
            
                // Helper function to format timestamps (optional)
                function formatTime(timestamp) {
                    const time = new Date(timestamp);
                    return time.toLocaleString(); // Formats in a readable way
                }
            
                fetchNotifications();
                setInterval(fetchNotifications, 10000);
            });
            

        </script>
        

        <script>

            document.addEventListener("DOMContentLoaded", function () {
                const userDropdownToggle = document.getElementById("userDropdownToggle");
                const userDropdown = document.getElementById("userDropdown");
            
                userDropdownToggle.addEventListener("click", function (event) {
                    event.stopPropagation();
                    userDropdown.classList.toggle("show");
                });
            
                // Close dropdown if clicking outside
                document.addEventListener("click", function (event) {
                    if (!userDropdown.contains(event.target) && !userDropdownToggle.contains(event.target)) {
                        userDropdown.classList.remove("show");
                    }
                });
            });
            
        </script>

        <script>
            document.getElementById("searchInput").addEventListener("input", async function () {
              let query = this.value.trim();
              let searchResults = document.getElementById("searchResults");
          
              if (query === "") {
                  searchResults.style.display = "none";
                  return;
              }
          
              try {
                  let response = await fetch(`/search_control_num?q=${encodeURIComponent(query)}`);
                  let data = await response.json();
          
                  searchResults.innerHTML = "";
                  if (data.length === 0) {
                      searchResults.innerHTML = "<div>No results found</div>";
                  } else {
                      data.forEach(user => {
                          let div = document.createElement("div");
                          div.textContent = `${user.control_num} - ${user.first_name} ${user.last_name}`;
                          div.onclick = () => window.location.href = `/view-client/${user.id}`;
                          searchResults.appendChild(div);
                      });
                  }
                  searchResults.style.display = "block";
              } catch (error) {
                  console.error("Error fetching search results:", error);
              }
          });
          
              
          </script>
        
        <script>
            function toggleSummary(summaryId) {
                // List of all summaries
                const summaries = ["rapid-summary", "comprehensive-summary"];
                
                summaries.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        if (id === summaryId) {
                            // Toggle visibility for the selected summary
                            element.style.display = (element.style.display === "none" || element.style.display === "") ? "block" : "none";
                        } else {
                            // Hide other summaries
                            element.style.display = "none";
                        }
                    }
                });
            }
            
        </script>
        
        <script>
            function printSummary() {
                
                window.print();

                window.onafterprint = function() {
  console.log('Print dialog closed');
}

            }
            
        </script>
        
        <script>
            function updateProviderText() {
                // Get selected value from the dropdown
                var selectedProvider = document.getElementById("serviceProvider").value;
        
                // Set the span text to the selected provider
                var providerText = document.getElementById("serviceProviderText");
                providerText.innerText = selectedProvider;
            }
        </script>
        
      
        <script>
            document.addEventListener("DOMContentLoaded", function() {
                // Attach event listeners for checkboxes and inputs
                document.querySelectorAll('input[name="services_provided[]"], input[name="recommended_action"]').forEach(input => {
                    input.addEventListener("change", updatePrintText);
                });
            
                document.getElementById("otherService").addEventListener("input", updatePrintText);
                document.getElementById("otherRecommendation").addEventListener("input", updatePrintText);
            
                // Attach event listeners for "Others" checkboxes to toggle input fields
                document.getElementById("otherOption").addEventListener("change", toggleOtherServiceInput);
                document.getElementById("otherOption2").addEventListener("change", toggleOtherRecommendationInput);
            
                toggleOtherServiceInput();
                
                // Ensure print text updates before printing
                window.onbeforeprint = updatePrintText;
            });
            
            function updatePrintText() {
                updateServiceText();
                updateRecommendedText();
            }
            
                function updateServiceText() {
    let selectedServices = [];

    document.querySelectorAll('input[name="services_provided[]"]').forEach(checkbox => {
        if (checkbox.checked) {
            if (checkbox.value === "Schedule Follow-up") {
                const datetimeInput = document.getElementById("followUpDateTime");
                const datetimeValue = datetimeInput.value;
                if (datetimeValue) {
                    const dateObj = new Date(datetimeValue);

                    const optionsDate = { year: 'numeric', month: 'long', day: '2-digit' };
                    const optionsTime = { hour: '2-digit', minute: '2-digit', hour12: true };

                    const formattedDate = dateObj.toLocaleDateString(undefined, optionsDate); // e.g., May 14, 2025
                    const formattedTime = dateObj.toLocaleTimeString(undefined, optionsTime); // e.g., 10:30 AM

                    selectedServices.push(`Schedule Follow-up\nDate: ${formattedDate}\nTime: ${formattedTime}`);
                } else {
                    selectedServices.push("Schedule Follow-up");
                }
            } else {
                selectedServices.push(checkbox.value);
            }
        }
    });

    if (document.getElementById("otherOption").checked) {
        let otherText = document.getElementById("otherService").value.trim();
        if (otherText !== "") {
            selectedServices.push(otherText);
        }
    }

    let servicesPrintText = document.getElementById("servicesPrintText");
    servicesPrintText.innerHTML = "";

    if (selectedServices.length > 0) {
        let ul = document.createElement("ul");
        selectedServices.forEach(service => {
            let li = document.createElement("li");
            // Replace \n with <br> for HTML display
            li.innerHTML = service.replace(/\n/g, "<br>");
            ul.appendChild(li);
        });
        servicesPrintText.appendChild(ul);
    }
}


               function updateRecommendedText() {
                    let selectedActions = [];
                    const recommendedPrintText = document.getElementById("recommendedPrintText");
                    recommendedPrintText.innerHTML = "";

                    // Handle each recommended action checkbox
                    document.querySelectorAll('input[name="recommended_action"]').forEach(checkbox => {
                        if (checkbox.checked) {
                            if (checkbox.value === "Schedule Follow-up") {
                                const datetimeInput = document.getElementById("recommendedFollowUpDateTime");
                                const datetimeValue = datetimeInput.value;
                                if (datetimeValue) {
                                    const dateObj = new Date(datetimeValue);

                                    const optionsDate = { year: 'numeric', month: 'long', day: '2-digit' };
                                    const optionsTime = { hour: '2-digit', minute: '2-digit', hour12: true };

                                    const formattedDate = dateObj.toLocaleDateString(undefined, optionsDate); // e.g., May 14, 2025
                                    const formattedTime = dateObj.toLocaleTimeString(undefined, optionsTime); // e.g., 10:30 AM

                                    selectedActions.push(`Schedule Follow-up\nDate: ${formattedDate}\nTime: ${formattedTime}`);
                                } else {
                                    selectedActions.push("Schedule Follow-up");
                                }
                            } else {
                                selectedActions.push(checkbox.value);
                            }
                        }
                    });

                    // Handle "Other" recommendation input
                    if (document.getElementById("otherOption2").checked) {
                        const otherText = document.getElementById("otherRecommendation").value.trim();
                        if (otherText !== "") {
                            selectedActions.push(otherText);
                        }
                    }

                    // Render to DOM
                    if (selectedActions.length > 0) {
                        const ul = document.createElement("ul");
                        selectedActions.forEach(action => {
                            const li = document.createElement("li");
                            li.innerHTML = action.replace(/\n/g, "<br>"); // Convert \n to <br> for HTML display
                            ul.appendChild(li);
                        });
                        recommendedPrintText.appendChild(ul);
                    }
                }

            
            function toggleOtherServiceInput() {
                let otherServiceContainer = document.getElementById("otherServiceContainer");
                if (document.getElementById("otherOption").checked) {
                    otherServiceContainer.style.display = "block";
                } else {
                    otherServiceContainer.style.display = "none";
                    document.getElementById("otherService").value = ""; // Reset value to avoid empty spaces
                    updatePrintText();
                }
            }
            
            function toggleOtherRecommendationInput() {
                let otherRecommendationContainer = document.getElementById("otherRecommendationContainer");
                if (document.getElementById("otherOption2").checked) {
                    otherRecommendationContainer.style.display = "block";
                } else {
                    otherRecommendationContainer.style.display = "none";
                    document.getElementById("otherRecommendation").value = ""; // Reset value to avoid empty spaces
                    updatePrintText();
                }
            }
            
            </script>
            
            
            <script>
                document.getElementById('saveButton').addEventListener('click', function (event) {
                    event.preventDefault(); // Prevent form submission
                    saveServicesAndRecommendations(); // Call the updated function
                });
                
                function saveServicesAndRecommendations() {
                    const checkedServices = document.querySelectorAll('input[name="services_provided[]"]:checked');
                    const otherServiceChecked = document.getElementById('otherOption').checked;
                    const selectedServices = Array.from(checkedServices).map(cb => cb.value);

                    if (selectedServices.includes('Schedule Follow-up')) {
                        const followUpDateTime = document.getElementById('followUpDateTime')?.value;
                        if (followUpDateTime) {
                            selectedServices.push(`Follow-up at ${followUpDateTime}`);
                        }
                    }
                
                    if (otherServiceChecked) {
                        const otherService = document.getElementById('otherService').value.trim();
                        if (otherService) {
                            selectedServices.push(otherService);
                        }
                    }
                
                    const checkedRecommendations = document.querySelectorAll('input[name="recommended_action"]:checked');
                    const otherRecChecked = document.getElementById('otherOption2').checked;
                    const selectedRecommendations = Array.from(checkedRecommendations).map(cb => cb.value);

                     // Include follow-up datetime if "Schedule Follow-up" is checked in recommendations
                    if (selectedRecommendations.includes('Schedule Follow-up')) {
                        const recFollowUpDateTime = document.getElementById('recommendedFollowUpDateTime')?.value;
                        if (recFollowUpDateTime) {
                            selectedRecommendations.push(`Follow-up at ${recFollowUpDateTime}`);
                        }
                    }
                
                    if (otherRecChecked) {
                        const otherRec = document.getElementById('otherRecommendation').value.trim();
                        if (otherRec) {
                            selectedRecommendations.push(otherRec);
                        }
                    }
                
                    const userId = document.getElementById('saveButton').getAttribute('data-user-id');
                
                    console.log("Selected services:", selectedServices);
                    console.log("Selected recommendations:", selectedRecommendations);
                
                    fetch('/save_services', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            user_id: userId,
                            services: selectedServices,
                            recommendations: selectedRecommendations
                        })
                    })
                    .then(response => {
                        if (response.ok) {
                            alert('Services and recommendations saved successfully!');
                        } else {
                            response.text().then(errorMessage => {
                                alert('Failed to save data: ' + errorMessage);
                            });
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('An error occurred: ' + error);
                    });

                    document.addEventListener('DOMContentLoaded', function() {
                        if (document.getElementById('otherOption').checked) {
                            document.getElementById('otherServiceContainer').style.display = 'block';
                        }
                        if (document.getElementById('otherOption2') && document.getElementById('otherOption2').checked) {
                            document.getElementById('otherRecommendationContainer').style.display = 'block';
                        }
                    });
                }
                </script>

                <script>
                    const checkbox = document.getElementById('scheduleFollowUp');
                    const calendar = document.getElementById('calendarContainer');
                  
                    function toggleCalendar() {
                      calendar.style.display = checkbox.checked ? 'block' : 'none';
                    }
                  
                    // Show/hide on load
                    toggleCalendar();
                  
                    // Toggle on checkbox change
                    checkbox.addEventListener('change', toggleCalendar);
                  </script>
                
                  <script>
                    // Toggle calendar for recommended follow-up
                    const recommendedCheckbox = document.getElementById('recommendedFollowUp');
                    const recommendedCalendar = document.getElementById('recommendedCalendarContainer');
                  
                    function toggleRecommendedCalendar() {
                      recommendedCalendar.style.display = recommendedCheckbox.checked ? 'block' : 'none';
                    }
                  
                    // Initial check
                    toggleRecommendedCalendar();
                  
                    // Event listener
                    recommendedCheckbox.addEventListener('change', toggleRecommendedCalendar);
                  </script>

                  <script>
  window.addEventListener('beforeprint', function () {
    const container = document.querySelector('.recommendation-container');
    const spacer = document.getElementById('printSpacer');

    if (container && spacer) {
      const rect = container.getBoundingClientRect();
      const pageHeight = 1122; // Rough height for A4 @ 96 DPI

      // If it's near the top of a new page (below threshold), add spacer
      if (rect.top < 200) {
        spacer.style.display = 'block';
        spacer.style.height = '50mm'; // Add more if needed
      } else {
        spacer.style.display = 'none';
        spacer.style.height = '0';
      }
    }
  });
</script>

 <script>
          function generateReport() {
            document.getElementById('reportModal').style.display = 'block';
            document.body.classList.add('modal-open');  // Disable background scroll
          }
          
          function closeModal() {
            document.getElementById('reportModal').style.display = 'none';
            document.body.classList.remove('modal-open');  // Re-enable background scroll
          }
          
          function submitReport() {
            alert("Report generation initiated!");
            closeModal();
          }
          
          // Optional: Close modal on outside click
          window.onclick = function(event) {
            const modal = document.getElementById('reportModal');
            if (event.target === modal) {
              closeModal();
            }
          }
          
        </script>

                
</body>

</html>